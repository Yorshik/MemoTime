<!DOCTYPE html>
<html>
  <head>
    <title>
      {% if form.instance.pk %}
        Edit Time Schedule
      {% else %}
        Create Time Schedule
      {% endif %}
    </title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
            integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
            crossorigin="anonymous"></script>
    <!-- Bootstrap bundle JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <!-- bootstrap-select -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
  </head>
  <body>
    <h2>
      {% if form.instance.pk %}
        Edit Time Schedule
      {% else %}
        Create Time Schedule
      {% endif %}
    </h2>
    <form method="post">
      {% csrf_token %}
      {% for field in form %}
        <div class="form-group">
          <label for="{{ field.id_for_label }}">{{ field.label }}</label>
          {{ field }}
          {% if field.errors %}
            <div class="invalid-feedback d-block">
              {{ field.errors|join:"<br>" }}
            </div>
          {% endif %}
        </div>
      {% endfor %}
      <button type="submit">Save</button>
      <a href="{% url 'schedule:timeschedule-event-create' schedule_id=schedule.id %}">Add Event</a>
      <a href="{% url 'schedule:teacher-create' %}">Add Teacher</a>
    </form>
    <script>
        $(document).ready(function () {
            $(".selectpicker").selectpicker({
                bootstrapVersion: "4",
                noneResultsText: 'Add new Teacher',
            });
            var eventSelect = $("#id_event");
            {% if events %}
            eventSelect.empty();
            eventSelect.append($("<option></option>").attr("value", "").text("---------"))
            {% for event in events %}
            eventSelect.append(
                $("<option></option>").attr("value", "{{ event.id }}").text("{{ event.name }}")
            );
            {% endfor %}
            {% if form.instance.event %}
            eventSelect.val("{{ form.instance.event.id }}");
            {% endif %}
            $('.selectpicker').selectpicker('refresh');
            {% endif %}
            var teacherSelect = $("#id_teacher");
            {% if teachers %}
            teacherSelect.empty();
            teacherSelect.append($("<option></option>").attr("value", "").text("---------"))
            {% for teacher in teachers %}
            teacherSelect.append(
                $("<option></option>").attr("value", "{{ teacher.id }}").text("{{ teacher.name }}")
            );
            {% endfor %}
            $('.selectpicker').selectpicker('refresh');
            {% endif %}
             $('.selectpicker').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {
                 if (isSelected === false ) return;
                  const selectedText = $(this).find('option').eq(clickedIndex).text();
                  if (selectedText === 'Add new Teacher')
                  {
                    window.location.href = '{% url 'schedule:teacher-create' %}'
                    $(this).selectpicker('val',previousValue);
                  }
              });
        });
    </script>
  </body>
</html>
